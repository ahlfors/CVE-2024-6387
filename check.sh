#!/bin/bash
vc(){ [[ "$(printf '%s\n' "$1" "$3"|sort -V|head -n1)" != "$1" || "$1" == "$3" ]]&&[[ "$2" == "<" ]]&&return 1;[[ "$(printf '%s\n' "$1" "$3"|sort -V|head -n1)" != "$3" || "$1" == "$3" ]]&&[[ "$2" == ">" ]]&&return 1;return 0;}
gov(){ if command -v apt-get>/dev/null;then dpkg -s openssh-server|grep '^Version:'|awk '{print $2}';elif command -v yum>/dev/null||command -v dnf>/dev/null;then rpm -qi openssh-server|grep '^Version'|awk '{print $3}';elif command -v pacman>/dev/null;then pacman -Qi openssh|grep 'Version'|awk '{print $3}';else echo "未知的Linux发行版或不支持的包管理器。"&&return 1;fi;}
ov=$(gov)
[ $? -eq 0 ]&&echo "Your OpenSSH Version：$ov"&&vc "$ov" ">=" "8.5p1"&&vc "$ov" "<" "9.8p1"&&echo "CVE-2024-6387 Exist!!!"||echo "CVE-2024-6387 Not Exist"||echo "Fail to get OpenSSH version."
